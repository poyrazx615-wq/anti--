<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vulnerability Analysis & Attack Advisory</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .terminal { background: #0f0f23; color: #10ff00; font-family: 'Courier New', monospace; }
        .vulnerability-critical { background: #dc2626; }
        .vulnerability-high { background: #ea580c; }
        .vulnerability-medium { background: #facc15; }
        .vulnerability-low { background: #84cc16; }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <div class="container mx-auto px-6 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2">
                <i class="fas fa-bug text-red-400"></i> Vulnerability Analysis & Attack Advisory
            </h1>
            <p class="text-gray-300">Zafiyet Tespiti ve Saldırı Önerileri</p>
        </div>

        <!-- Scan Section -->
        <div class="bg-white/10 backdrop-blur rounded-2xl p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">
                <i class="fas fa-radar"></i> Target Scan & Analysis
            </h2>
            
            <div class="flex space-x-4 mb-4">
                <input type="text" id="target" placeholder="Enter target (IP/URL/Domain)" 
                       class="flex-1 px-4 py-3 text-gray-900 rounded-lg">
                <button onclick="startScan()" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-bold">
                    <i class="fas fa-search"></i> Scan & Analyze
                </button>
            </div>

            <!-- Scan Output -->
            <div class="terminal rounded-lg p-4 h-64 overflow-y-auto mb-4" id="scan-output">
                <div>$ Ready for vulnerability scanning...</div>
            </div>
        </div>

        <!-- Vulnerability Report -->
        <div id="vuln-report" class="hidden">
            <!-- Risk Summary -->
            <div class="bg-white/10 backdrop-blur rounded-2xl p-6 mb-8">
                <h3 class="text-xl font-bold mb-4">
                    <i class="fas fa-chart-pie"></i> Risk Assessment
                </h3>
                <div class="grid grid-cols-4 gap-4">
                    <div class="bg-red-600/50 p-4 rounded-lg text-center">
                        <div class="text-3xl font-bold" id="critical-count">0</div>
                        <div>Critical</div>
                    </div>
                    <div class="bg-orange-600/50 p-4 rounded-lg text-center">
                        <div class="text-3xl font-bold" id="high-count">0</div>
                        <div>High</div>
                    </div>
                    <div class="bg-yellow-600/50 p-4 rounded-lg text-center">
                        <div class="text-3xl font-bold" id="medium-count">0</div>
                        <div>Medium</div>
                    </div>
                    <div class="bg-green-600/50 p-4 rounded-lg text-center">
                        <div class="text-3xl font-bold" id="risk-score">0</div>
                        <div>Risk Score</div>
                    </div>
                </div>
            </div>

            <!-- Vulnerabilities List -->
            <div class="bg-white/10 backdrop-blur rounded-2xl p-6 mb-8">
                <h3 class="text-xl font-bold mb-4">
                    <i class="fas fa-exclamation-triangle"></i> Detected Vulnerabilities
                </h3>
                <div id="vulnerabilities-list"></div>
            </div>

            <!-- Attack Plan -->
            <div class="bg-white/10 backdrop-blur rounded-2xl p-6 mb-8">
                <h3 class="text-xl font-bold mb-4">
                    <i class="fas fa-crosshairs"></i> Attack Plan & Exploitation Guide
                </h3>
                <div id="attack-plan"></div>
            </div>

            <!-- Exploit Examples -->
            <div class="bg-white/10 backdrop-blur rounded-2xl p-6">
                <h3 class="text-xl font-bold mb-4">
                    <i class="fas fa-code"></i> Exploitation Examples
                </h3>
                <div id="exploit-examples" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <script>
        let currentScanResults = '';

        async function startScan() {
            const target = document.getElementById('target').value;
            if (!target) {
                alert('Please enter a target!');
                return;
            }

            const output = document.getElementById('scan-output');
            output.innerHTML = '<div class="text-yellow-400">Scanning ' + target + '...</div>';

            // First, run the scan
            try {
                const scanResponse = await fetch('/api/quick-scan', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        target: target,
                        scan_type: 'full'
                    })
                });

                const scanData = await scanResponse.json();
                currentScanResults = scanData.output || '';
                
                // Display scan results
                output.innerHTML = '<pre>' + currentScanResults + '</pre>';

                // Analyze vulnerabilities
                await analyzeVulnerabilities(target, currentScanResults);

            } catch (error) {
                output.innerHTML = '<div class="text-red-400">Error: ' + error.message + '</div>';
            }
        }

        async function analyzeVulnerabilities(target, scanResults) {
            try {
                const response = await fetch('/api/vulnerability-analysis', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        target: target,
                        scan_results: scanResults
                    })
                });

                const data = await response.json();
                displayVulnerabilityReport(data);

            } catch (error) {
                console.error('Analysis error:', error);
            }
        }

        function displayVulnerabilityReport(data) {
            // Show report section
            document.getElementById('vuln-report').classList.remove('hidden');

            // Update counts
            const criticalCount = data.vulnerabilities.filter(v => v.severity === 'Critical').length;
            const highCount = data.vulnerabilities.filter(v => v.severity === 'High').length;
            const mediumCount = data.vulnerabilities.filter(v => v.severity === 'Medium').length;
            
            document.getElementById('critical-count').textContent = criticalCount;
            document.getElementById('high-count').textContent = highCount;
            document.getElementById('medium-count').textContent = mediumCount;
            document.getElementById('risk-score').textContent = Math.round(data.risk_score) + '%';

            // Display vulnerabilities
            const vulnList = document.getElementById('vulnerabilities-list');
            vulnList.innerHTML = '';
            
            data.vulnerabilities.forEach(vuln => {
                const severityColor = {
                    'Critical': 'bg-red-600',
                    'High': 'bg-orange-600',
                    'Medium': 'bg-yellow-600',
                    'Low': 'bg-green-600'
                }[vuln.severity];

                vulnList.innerHTML += `
                    <div class="border-l-4 ${severityColor} border-opacity-50 pl-4 mb-4">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-bold text-lg">${vuln.name}</h4>
                                <p class="text-gray-300">${vuln.description}</p>
                                <p class="text-sm mt-2">
                                    <span class="bg-gray-700 px-2 py-1 rounded">CVSS: ${vuln.cvss}</span>
                                    <span class="bg-gray-700 px-2 py-1 rounded ml-2">Impact: ${vuln.impact}</span>
                                </p>
                            </div>
                            <button onclick="showExploitGuide('${vuln.type}')" 
                                    class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg">
                                <i class="fas fa-skull"></i> Exploit
                            </button>
                        </div>
                    </div>
                `;
            });

            // Display attack plan
            const attackPlan = document.getElementById('attack-plan');
            attackPlan.innerHTML = '';
            
            if (data.attack_plan && data.attack_plan.step_by_step) {
                data.attack_plan.step_by_step.forEach(step => {
                    attackPlan.innerHTML += `
                        <div class="bg-gray-800 rounded-lg p-4 mb-4">
                            <h4 class="font-bold">Step ${step.step}: ${step.target}</h4>
                            <p class="text-gray-300 mt-2">${step.description}</p>
                            ${step.automated_tool ? `
                                <div class="mt-2">
                                    <span class="bg-blue-600 px-2 py-1 rounded text-sm">
                                        Tool: ${step.automated_tool}
                                    </span>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });

                // Display recommended tools
                if (data.attack_plan.recommended_tools) {
                    attackPlan.innerHTML += `
                        <div class="mt-4">
                            <h4 class="font-bold mb-2">Recommended Tools:</h4>
                            <div class="flex flex-wrap gap-2">
                                ${Array.from(data.attack_plan.recommended_tools).map(tool => 
                                    `<span class="bg-purple-600 px-3 py-1 rounded">${tool}</span>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
            }

            // Display recommendations
            if (data.recommendations && data.recommendations.length > 0) {
                attackPlan.innerHTML += `
                    <div class="mt-6 bg-blue-600/20 rounded-lg p-4">
                        <h4 class="font-bold mb-2">
                            <i class="fas fa-shield-alt"></i> Security Recommendations:
                        </h4>
                        <ul class="list-disc list-inside text-gray-300">
                            ${data.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
        }

        async function showExploitGuide(vulnerabilityType) {
            try {
                const response = await fetch('/api/exploit-guide/' + vulnerabilityType);
                const exploitData = await response.json();
                
                const exploitExamples = document.getElementById('exploit-examples');
                exploitExamples.innerHTML = `
                    <div class="bg-gray-900 rounded-lg p-6">
                        <h4 class="font-bold text-xl mb-4 text-red-400">
                            <i class="fas fa-skull-crossbones"></i> Exploitation Guide: ${vulnerabilityType}
                        </h4>
                        
                        <!-- Tools -->
                        <div class="mb-4">
                            <h5 class="font-semibold mb-2">Recommended Tools:</h5>
                            <div class="flex gap-2">
                                ${exploitData.tools.map(tool => 
                                    `<span class="bg-purple-600 px-3 py-1 rounded">${tool}</span>`
                                ).join('')}
                            </div>
                        </div>

                        <!-- Manual Tests -->
                        ${exploitData.manual_test ? `
                            <div class="mb-4">
                                <h5 class="font-semibold mb-2">Manual Test Payloads:</h5>
                                <div class="bg-black rounded p-3 font-mono text-sm">
                                    ${Object.entries(exploitData.manual_test).map(([key, value]) => 
                                        `<div class="mb-2">
                                            <span class="text-yellow-400">${key}:</span>
                                            <span class="text-green-400">${value}</span>
                                        </div>`
                                    ).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <!-- Example Attack -->
                        ${exploitData.example_attack ? `
                            <div class="mb-4">
                                <h5 class="font-semibold mb-2">Example Attack Commands:</h5>
                                <pre class="bg-black rounded p-3 text-green-400 text-xs overflow-x-auto">${exploitData.example_attack}</pre>
                            </div>
                        ` : ''}

                        <!-- Prevention -->
                        ${exploitData.prevention ? `
                            <div class="bg-blue-600/20 rounded p-3">
                                <h5 class="font-semibold mb-2">
                                    <i class="fas fa-shield-alt"></i> Prevention:
                                </h5>
                                <p class="text-gray-300">${exploitData.prevention}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                // Scroll to examples
                exploitExamples.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                console.error('Error fetching exploit guide:', error);
            }
        }
    </script>
</body>
</html>
